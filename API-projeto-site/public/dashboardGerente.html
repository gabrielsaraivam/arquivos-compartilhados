<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Overall</title>

     <!-- script do google charts -->
     <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
     <script type="text/javascript" src="./funcoes.js"></script>
     <script type="text/javascript" src="./funcoesCargo.js"></script>
     <script type="text/javascript" src="./funcoesLocalizacao.js"></script>
 
     <!-- scripts do Chart.js -->
     <script type="text/javascript" src="https://www.chartjs.org/dist/2.8.0/Chart.min.js"></script>

     <link rel="sortcut icon" href="./img/logo.png" type="image/x-icon"/>

    <script src="./js/bootstrap.js"></script>
    <link rel="stylesheet" href="./css/bootstrap.css">
    <link rel="stylesheet" href="./styleDash.css">

    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900" rel="stylesheet">
		
		<script src="https://kit.fontawesome.com/fee5906543.js" crossorigin="anonymous"></script>
		<link rel="stylesheet" href="./cssSB/style.css">


</head>
<body>
  
    <div class="wrapper d-flex align-items-stretch">
      <nav id="sidebar" class="menu">
        <div class="custom-menu">
          <button type="button" id="sidebarCollapse" class="btn btn-primary">
            <i class="fa fa-bars"></i>
            <span class="sr-only">Toggle Menu</span>
          </button>
        </div>
        <div class="" >
          <h1 class="p-4"><a href="index.html" id="imgLogo"><img src="./img/logo-black.png" alt=""></a></h1>
          <ul class="list-unstyled components mb-5">
            <li class="li-active pl-4 pr-4">
              <a href="dashboardGerente.html"><span class="fas fa-chart-pie mr-3"></span>Dashboard</a>
            </li>
            <li class="pl-4 pr-4">
                <a href="cadastroUsuario.html" id="aUser"><span class="fa fa-user mr-3"></span>Cadastrar Usuário</a>
            </li>
            <li class="pl-4 pr-4">
              <a href="cadastroCaixa.html" id="aCaixa"><span class="fas fa-credit-card mr-3"></span>Caixas Eletrônicos</a>
            </li>
            <li class="pl-4 pr-4">
              <a href="#" onclick="apiGeo()"><span class="fas fa-map-marked-alt mr-3"></span>Geolocalização</a>
            </li>

            <li class="pl-4 pr-4">
              <a href="billing.html"><span class="fab fa-aws mr-3"></span>Billing</a>
            </li>

            <li class="pl-4 pr-4">
              <a href="#" onclick="logoff()"><span class="fa fas fa-sign-out-alt mr-3"></span>Logoff</a>
            </li>
          </ul>

          <div class="footer">
            <p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->

              <!-- Copyright &copy;2021</a> -->
              <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p>
          </div>

        </div>
      </nav>

      <!-- <div class="container">
        <div class="container">
          <div class="row">
            <div class="col-lg-12 col-md-12" style="background-color: red;"></div>
          </div>
        </div> -->

        <script>

          // localStorage.setItem('name', 'Treinaweb');
          // localStorage['name'] = 'Treinaweb';
          // alert(localStorage['name']);

          function verificar_autenticacao() {
              nome_usuario = sessionStorage.nome_usuario_meuapp;
              id_usuario = sessionStorage.id_usuario_meuapp;
              senha_usuario = sessionStorage.senha_usuario_meuapp;

              if (nome_usuario == undefined)  {
                  redirecionar_login();
              } else {
                  usuario.innerHTML = nome_usuario;
                  // validar_sessao();
              }

          }
                   
        </script>

        <div id="content" class="p-4 p-md-5 pt-5">
          <div class="row container col-md-12 col-lg-12 col-sm-12 col-xs-12 col-xl-12 border-bottom">
            <h6 class="mr-auto" id="hCargo">Empresa</h6>
            <h6 id="usuario" class="ml-auto"></h6>
          </div>

          <div class="row mt-2 container col-12">
            <h2 class="color-text">Dados históricos</h2>
            <div class="col-7  col-sm-4 col-md-4 col-lg-3 ml-auto p-0 pt-2" >
              <div class="col-12 p-0">
                <label class="col-5 col-sm-7 col-lg-5 p-0 row ml-auto">
                  <input type="checkbox" id="switch"> 
                  <div style="height: 3vh;">
                    <span class="fa fa-sun-o"></span>
                  </div>
                  <div class="check col-6 ml-2 mr-2"></div> 
                  <div style="height: 3vh;">
                    <span class="fa fa-moon-o"></span>
                  </div>
                </label>
              </div>
            </div>
          </div>

          <div class="row container col-6">
            <div style="position: relative; z-index: 9999;" class="dropdown mr-auto col-5">
              <button class="btn btn-secondary dropdown-toggle col-12" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span id="mudarMaquina">Máquina 1</span>
              </button>
              <div class="dropdown-menu" id="dropdownMaquina" aria-labelledby="dropdownMenuButton">

              </div>
            </div>
          </div>
<div style="position: absolute; height: 92%; width: 75%; z-index: 1;">

    </div> 
          <div class="row container col-12 p-0 mb-2">
            <div class="row container col-12 p-0 mb-2">
              <div class="mt-3 col-md-8 col-lg-8 col-sm-8 col-xl-8 rounded">
                <div class="col-12 col-md-12 col-lg-12 col-sm-12 col-xl-12 rounded divs-graphcs-big" >
                  <canvas id="canvas_grafico"></canvas>
                </div>
              </div> 
            
              <!-- <div class="col-md-1 col-lg-1" style="background-color: red; height: 1%;"></div> -->
              <div class="my-auto mt-3 col-md-4 col-lg-4 col-sm-4 col-xl-4 p-0 m-0">
                <div>
                  <div class="card border-dark mx-auto">
                    <div id="cores-cards-header" class="card-header">Número total de Alertas</div>
                    <div class="card-body text-dark cores-cards-body row m-0">

                      <h1 class="col-6 col-lg-4 mx-auto p-0 pt-1 m-0" id="numeroTotalAlertas" style="font-size: 50px;">000</h1>
                    </div>
                  </div>
                
              </div>   
            </div>
           </div> 
      
          <div class="row container col-12 p-0 mb-2">
            <div class="mt-3 col-md-8 col-lg-8 col-sm-8 col-xl-8 mr-auto rounded">
              <div class="col-12 col-md-12 col-lg-12 col-sm-12 col-xl-12 rounded divs-graphcs-big" >
                <canvas id="canvas_grafico2"></canvas>
              </div>
            </div>
            <!-- <div class="col-md-1 col-lg-1" style="background-color: red; height: 1%;"></div> -->
            <div class="my-auto mt-3 col-md-4 col-lg-4 col-sm-4 col-xl-4 p-0 m-0">
              <div>
                <div class="card border-dark mx-auto">
                  <div id="cores-cards-header" class="card-header">Média de Processos</div>
                  <div class="col-12 card-body text-dark cores-cards-body row m-0">
                    <h1 class="col-6 col-md-8 col-lg-4 mx-auto p-0 pt-1 m-0" id="numeroMediaProcesso" style="font-size: 50px;">000</h1>
                  </div>
                </div>
              
            </div>   
          </div>
        </div>
      </div>
      
    </div>
  
</body>
</html>

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js"></script>

<!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js" crossorigin="anonymous"></script> -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>


<script src="./jsSb/jquery.min.js"></script>
<script src="./jsSb/popper.js"></script>
<!-- <script src="./jsSb/bootstrap.min.js"></script> -->
<script src="./jsSb/main.js"></script>

<!-- max-width: 991.98px -->



<script>

  window.addEventListener('resize', function ajustarSideBar() {
    //var altura = window.innerHeight;
    var largura = window.innerWidth;

    if (largura < 1258) 
        // document.getElementsByClassName('menu')[0].className = 'responsivemenu';
        sidebar.style = "position: fixed; z-index: 9999; height: 100%;"

    else sidebar.style = ""
});

$(document).ready(function() {
  var largura = $(window).width();

  if (largura < 1258) 
        // document.getElementsByClassName('menu')[0].className = 'responsivemenu';
        sidebar.style = "position: fixed; z-index: 9999; height: 100%;"

    else sidebar.style = ""
});

const $html = document.querySelector('html')
    const $checkbox = document.querySelector('#switch')

    $checkbox.addEventListener('change', function(){
        $html.classList.toggle('dark-mode')
    })
</script>


<script>
  var otherCheckbox = document.querySelector ('#switch');

 otherCheckbox.onchange = function () {
  if (otherCheckbox.checked) {
    imgLogo.innerHTML=`<img src="./img/logo-white.png" alt="aa">`
  } else{
    imgLogo.innerHTML=`<img src="./img/logo-black.png" alt="aa">`
  }
};
</script>

<!-- $(document).ready(function() {
  var largura = $(window).width();

  if (largura < 940.98) 
        // document.getElementsByClassName('menu')[0].className = 'responsivemenu';
        sidebar.style = "position: absolute; z-index: 9999; height: 100vh;"

    else sidebar.style = ""
}); -->

<!-- <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> -->

<!-- ssssssssssssssssss -->

<script>



function consultarMaquina(){
              
  for(var i = 1;i<=Cookies.get('qtdLocalizacao');i++){
    dropdownMaquina.innerHTML+=`<option class="dropdown-item" onclick="chamarMaquina(${i})">Máquina ${i}</option>`
  }
}

function chamarMaquina(valor){
  mudarMaquina.innerHTML = `Máquina ${valor}`
  obterDadosGraficoPrimeiraVez(sessionStorage[`maquina${valor}`])
//   setTimeout(() => obterDadosGraficoPrimeiraVez(valor), 5000);
}
 let proximaAtualizacao;

  window.onload = inicializacao();

  function inicializacao(){
    verificarCargo();
    consultarMaquina();
    getIdCaixa();
    obterDadosGraficoPrimeiraVez(sessionStorage[`maquina1`]);
  }


  verificar_autenticacao();






var cpuAlert = 0;
var memoriaAlert = 0;
var discoAlert = 0;

var cpuMedia = 0;
var memoriaMedia = 0;
var discoMedia = 0;
var processosMedia = 0;

var count = 0;

function obterDadosGraficoPrimeiraVez(idCaixaEletronico) {


   count=0;

    atualizarGrafico(idCaixaEletronico)

    
}

function atualizarGrafico(idCaixaEletronico) {


    if (proximaAtualizacao != undefined) {
        clearTimeout(proximaAtualizacao);
    }

    fetch(`/tblDadosHardwares/AlertasCpu/${idCaixaEletronico}`, { cache: 'no-store' }).then(function (response) {
        if (response.ok) {
            response.json().then(function (resposta) {
                console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
              
                    cpuAlert = resposta.AlertasCpu
              
                    console.log("meu sensor é o " + idCaixaEletronico)


             
                
            });
        } else {
            console.error('Nenhum dado encontrado ou erro na API');
        }
    })
    .catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    });

    fetch(`/tblDadosHardwares/AlertasMemoria/${idCaixaEletronico}`, { cache: 'no-store' }).then(function (response) {
        if (response.ok) {
            response.json().then(function (resposta) {
                console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                // if ( dados.datasets[0].data.length == 1){
                //         // dados.labels.shift();
                //         dados.datasets[0].data.shift();
                //         //dados.datasets[1].data.shift();
                // }
                    // dados.labels.push(novoRegistro.dataHora_grafico); // incluir um novo dataHora
                    // dados.datasets[0].data.shift();  // apagar o primeiro de cpu
                    // dados.datasets[1].data.shift();  // apagar o primeiro de memoria
                    // dados.datasets[1].data.push(resposta.AlertasMemoria); // incluir uma nova tblDadosHardware de cpu
                    memoriaAlert = resposta.AlertasMemoria;
                    // dados.datasets[1].data.push(novoRegistro.memoria); // incluir uma nova tblDadosHardware de memoria
                    console.log("meu sensor é o " + idCaixaEletronico)

                    // window.grafico_linha.update();

            });
        } else {
            console.error('Nenhum dado encontrado ou erro na API');
        }
    })
    .catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    });

    fetch(`/tblDadosHardwares/AlertasDisco/${idCaixaEletronico}`, { cache: 'no-store' }).then(function (response) {
        if (response.ok) {
            response.json().then(function (resposta) {
                console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                // if ( dados.datasets[0].data.length == 1){
                //         // dados.labels.shift();
                //         dados.datasets[0].data.shift();
                //         //dados.datasets[1].data.shift();
                // }
                    // dados.labels.push(novoRegistro.dataHora_grafico); // incluir um novo dataHora
                    // dados.datasets[0].data.shift();  // apagar o primeiro de cpu
                    // dados.datasets[1].data.shift();  // apagar o primeiro de memoria
                    // dados.datasets[1].data.push(resposta.AlertasMemoria); // incluir uma nova tblDadosHardware de cpu
                    discoAlert = resposta.AlertasDisco;
                    // dados.datasets[1].data.push(novoRegistro.memoria); // incluir uma nova tblDadosHardware de memoria
                    console.log("meu sensor é o " + idCaixaEletronico)

                    // window.grafico_linha.update();

            });
        } else {
            console.error('Nenhum dado encontrado ou erro na API');
        }
    })
    .catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    });


    fetch(`/tblDadosHardwares/MediaCpu/${idCaixaEletronico}`, { cache: 'no-store' }).then(function (response) {
        if (response.ok) {
            response.json().then(function (resposta) {
                console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                // plotarGrafico(resposta);
                // if ( dados.datasets[0].data.length == 1){
                //         // dados.labels.shift();
                //         dados.datasets[0].data.shift();
                //         //dados.datasets[1].data.shift();
                // }
                    // dados.labels.push(novoRegistro.dataHora_grafico); // incluir um novo dataHora
                    // dados.datasets[0].data.shift();  // apagar o primeiro de cpu
                    // dados.datasets[1].data.shift();  // apagar o primeiro de memoria
                    // dados.datasets[0].data.push(resposta.AlertasCpu); // incluir uma nova tblDadosHardware de cpu
                    cpuMedia = resposta.MediaCpu
                    // dados.datasets[1].data.push(novoRegistro.memoria); // incluir uma nova tblDadosHardware de memoria
                    console.log("meu sensor é o " + idCaixaEletronico)

                    // window.grafico_linha.update();


                    // proximaAtualizacao = setTimeout(() => atualizarGrafico(idCaixaEletronico, dados), 5000);
                
            });
        } else {
            console.error('Nenhum dado encontrado ou erro na API');
        }
    })
    .catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    });

    fetch(`/tblDadosHardwares/MediaMemoria/${idCaixaEletronico}`, { cache: 'no-store' }).then(function (response) {
        if (response.ok) {
            response.json().then(function (resposta) {
                console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                // plotarGrafico(resposta);
                // if ( dados.datasets[0].data.length == 1){
                //         // dados.labels.shift();
                //         dados.datasets[0].data.shift();
                //         //dados.datasets[1].data.shift();
                // }
                    // dados.labels.push(novoRegistro.dataHora_grafico); // incluir um novo dataHora
                    // dados.datasets[0].data.shift();  // apagar o primeiro de cpu
                    // dados.datasets[1].data.shift();  // apagar o primeiro de memoria
                    // dados.datasets[0].data.push(resposta.AlertasCpu); // incluir uma nova tblDadosHardware de cpu
                    memoriaMedia = resposta.MediaMemoria
                    // dados.datasets[1].data.push(novoRegistro.memoria); // incluir uma nova tblDadosHardware de memoria
                    console.log("meu sensor é o " + idCaixaEletronico)

                    // window.grafico_linha.update();


                    // proximaAtualizacao = setTimeout(() => atualizarGrafico(idCaixaEletronico, dados), 5000);
                
            });
        } else {
            console.error('Nenhum dado encontrado ou erro na API');
        }
    })
    .catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    });

    fetch(`/tblDadosHardwares/MediaDisco/${idCaixaEletronico}`, { cache: 'no-store' }).then(function (response) {
        if (response.ok) {
            response.json().then(function (resposta) {
                console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                // plotarGrafico(resposta);
                // if ( dados.datasets[0].data.length == 1){
                //         // dados.labels.shift();
                //         dados.datasets[0].data.shift();
                //         //dados.datasets[1].data.shift();
                // }
                    // dados.labels.push(novoRegistro.dataHora_grafico); // incluir um novo dataHora
                    // dados.datasets[0].data.shift();  // apagar o primeiro de cpu
                    // dados.datasets[1].data.shift();  // apagar o primeiro de memoria
                    // dados.datasets[0].data.push(resposta.AlertasCpu); // incluir uma nova tblDadosHardware de cpu
                    discoMedia = resposta.MediaDisco
                    // dados.datasets[1].data.push(novoRegistro.memoria); // incluir uma nova tblDadosHardware de memoria
                    console.log("meu sensor é o " + idCaixaEletronico)

                    // window.grafico_linha.update();


                    // proximaAtualizacao = setTimeout(() => atualizarGrafico(idCaixaEletronico, dados), 5000);
                
            });
        } else {
            console.error('Nenhum dado encontrado ou erro na API');
        }
    })
    .catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    });

    fetch(`/tblDadosHardwares/MediaProcessos/${idCaixaEletronico}`, { cache: 'no-store' }).then(function (response) {
        if (response.ok) {
            response.json().then(function (resposta) {
                console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                // plotarGrafico(resposta);
                // if ( dados.datasets[0].data.length == 1){
                //         // dados.labels.shift();
                //         dados.datasets[0].data.shift();
                //         //dados.datasets[1].data.shift();
                // }
                    // dados.labels.push(novoRegistro.dataHora_grafico); // incluir um novo dataHora
                    // dados.datasets[0].data.shift();  // apagar o primeiro de cpu
                    // dados.datasets[1].data.shift();  // apagar o primeiro de memoria
                    // dados.datasets[0].data.push(resposta.AlertasCpu); // incluir uma nova tblDadosHardware de cpu
                    processosMedia = resposta.MediaProcessos
                    // dados.datasets[1].data.push(novoRegistro.memoria); // incluir uma nova tblDadosHardware de memoria
                    console.log("meu sensor é o " + idCaixaEletronico)

                    // window.grafico_linha.update();


                    // proximaAtualizacao = setTimeout(() => atualizarGrafico(idCaixaEletronico, dados), 5000);
                
            });
        } else {
            console.error('Nenhum dado encontrado ou erro na API');
        }
    })
    .catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    });
    // window.grafico_linha.update();

// const data3 = {
//   labels: [
//     'CPU',
//     'Memória',
//   ],
//   datasets: [{
//     label: 'My First Dataset',
//     data: [cpuAlert, memoriaAlert],
//     backgroundColor: [
//       '#1c84e9',
//       '#0876ee99',
//       '#1c84e950'
//     ],

//     borderColor: '#ffffff00'
//   }],
//   animation: { duration: 500 }
// };

// const config3 = {
//   type: 'polarArea',
//   data: data3,
// };


// var myChart3 = new Chart(
//     document.getElementById('myChart3'),
//     config3
// );

const data = {
  labels: [
    'CPU',
    'Memória',
    'Disco'
  ],
  datasets: [{
    label: 'Histórico de alertas',
    data: [cpuAlert, memoriaAlert, discoAlert],
    backgroundColor: [
      '#1c84e9',
      '#0876ee99',
      '#1c84e950'
    ],

    borderColor: '#ffffff00'
  }]
};

const config = {
  type: 'bar',
  data: data,
};


var myChart = new Chart(
    document.getElementById('canvas_grafico'),
    config
);

const data2 = {
  labels: [
    'CPU',
    'Memória',
    'Disco'
  ],
  datasets: [{
    label: 'Média de valores',
    data: [cpuMedia, memoriaMedia, discoMedia],
    backgroundColor: [
      '#1c84e9',
      '#0876ee99',
      '#1c84e950'
    ],

    borderColor: '#ffffff00'
  }]
};

const config2 = {
  type: 'bar',
  data: data2,
};


var myChart2 = new Chart(
    document.getElementById('canvas_grafico2'),
    config2
);

    numeroTotalAlertas.innerHTML = cpuAlert+memoriaAlert+discoAlert;
    numeroMediaProcesso.innerHTML = processosMedia;
    
    if(count==0){
      proximaAtualizacao = setTimeout(() => atualizarGrafico(idCaixaEletronico), 500);
    }
count++
}

// só mexer se quiser alterar o tempo de atualização
// ou se souber o que está fazendo!
// function atualizarGrafico(dados) {
//     fetch(`/medidas/tempo-real`, { cache: 'no-store' }).then(function (response) {
//         if (response.ok) {
//             response.json().then(function (novoRegistro) {
//                 novoRegistro.reverse();
//                 console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
//                 console.log(`Dados atuais do gráfico: ${dados}`);
                
//                 // tirando e colocando valores no gráfico
                

//                 // apagar o primeiro
//                  // incluir um novo momento
//                 // dados.datasets[0].data.shift();  // apagar o primeiro de umidade
//                 dados.datasets[0].data.push(novoRegistro[0].quantidade); // incluir uma nova medida de umidade

//                 window.grafico_linha.update();
//                 plotarGrafico(novoRegistro);
//                 // proximaAtualizacao = setTimeout(() => atualizarGrafico(dados), 3000);
//             });
//         } else {
//             console.error('Nenhum dado encontrado ou erro na API');
//             proximaAtualizacao = setTimeout(() => atualizarGrafico(dados), 5000);
//         }
//     })
//         .catch(function (error) {
//             console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
//         });

// }

function apiGeo(){
    for(var i = 1; i<=Cookies.get('qtdLocalizacao'); i++){
      Cookies.remove(`alertaAtivo${i}`);
    }

    getLocalizacao();
    window.open("http://localhost:8080/");
  }
</script>
